version: '3.8'

services:
  # 1. The Python Application (Gunicorn)
  app:
    build: .
    container_name: ward_list_app
    restart: unless-stopped
    expose:
      - "8000"  # Only exposed internally to the nginx container
    environment:
      # Defaults to a random key if not provided (handled in app.py), 
      # but passes the env var if Portainer sets one.
      - FLASK_SECRET_KEY=${FLASK_SECRET_KEY}
    
  # 2. The Local Proxy (Nginx)
  nginx:
    build:
      context: .
      dockerfile: Dockerfile.nginx
    container_name: ward_list_nginx
    restart: unless-stopped
    ports:
      - "${WARD_QUIZ_PORT:-8625}:80"
    depends_on:
      - app