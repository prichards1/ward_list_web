version: '3.8'

services:
  # 1. The Python Application (Gunicorn)
  app:
    build: .
    container_name: ward_list_app
    restart: unless-stopped
    expose:
      - "8000"  # Only exposed internally to the nginx container, not the host
    environment:
      - FLASK_SECRET_KEY=${FLASK_SECRET_KEY}
    volumes:
      # Optional: Mount code so you can edit without rebuilding (Dev mode)
      # Remove this line in true production if you want immutable images
      - ./:/app

  # 2. The Local Proxy (Nginx)
    nginx:
      # REMOVE: image: nginx:alpine
      # ADD: Build instructions
      build:
        context: .
        dockerfile: Dockerfile.nginx
      container_name: ward_list_nginx
      restart: unless-stopped
      ports:
        - "${WARD_QUIZ_PORT:-8625}:80"
      # REMOVE the 'volumes' section completely!
      # volumes:
      #   - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
      depends_on:
        - app

